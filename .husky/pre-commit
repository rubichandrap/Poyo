#!/bin/bash
set -e

echo "ğŸ” Checking running processes..."
# # Check for Poyo.Server (case insensitive)
# if tasklist | grep -i "Poyo.Server.exe" > /dev/null 2>&1; then
#   echo "ğŸš« Poyo.Server.exe is currently RUNNING!"
#   echo "ğŸ›‘ Please stop the application before committing."
#   echo "ğŸ’¡ Close the app or stop debugging, then try again."
#   exit 1
# fi

# --- Client Checks ---
echo "ğŸ¨ Checking Client Compliance (Lint, Format, Types)..."

cd poyo.client

echo "ğŸ‘‰ Running Type Check..."
if ! npm run type-check; then
  echo "âŒ Type check failed!"
  exit 1
fi

echo "ğŸ‘‰ Running Lint..."
if ! npm run lint; then
  echo "âŒ Linting failed!"
  exit 1
fi

echo "ğŸ‘‰ Running Format Check..."
if ! npm run format; then
  echo "âŒ Formatting issues found!"
  exit 1
fi

cd ..

# --- Server Checks ---
echo "ğŸ§° Restoring .NET tools (if any)..."
dotnet tool restore || true

echo "ğŸ‘‰ Running Format Check..."
if ! dotnet format --verify-no-changes; then
  echo "âŒ Formatting issues found!"
  exit 1
fi

echo "ğŸ—ï¸  Building solution (Poyo.sln)..."
if ! dotnet build "Poyo.sln" --no-restore --verbosity minimal; then
  echo "ğŸ”¥ Build FAILED!"
  echo "ğŸ§¯ Fix build errors before committing."
  exit 1
fi

echo "ğŸ‰ All checks passed!"
echo "âœ… Your code is clean"
echo "ğŸš¢ Safe to commit â€” happy coding!"
exit 0
